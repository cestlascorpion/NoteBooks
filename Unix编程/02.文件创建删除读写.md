# Colletion of Tricks

## open()函数

open 函数可以打开或创建一个文件。返回值：成功返回新分配的文件描述符名，出错返回-1并设置errno。

```cpp
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
int open(const char *pathname, int flags);
int open(const char *pathname, int flags, mode_t mode);
```

在Man Page中open函数有两种形式，一种带两个参数，一种带三个参数。其实在C代码中open 函数是这样声明的：

```cpp
int open(const char *pathname, int flags, ...);
```

最后的可变参数可以是0个或1个，由flags 参数中的标志位决定。pathname参数是要打开或创建的文件名，pathname既可以是相对路径也可以是绝对路径。flags参数有一系列常数值可供选择，可以同时选择多个常数用按位或运算符连接起来，所以这些常数的宏定义都以O_开头，表示or。

必选项：以下三个常数中必须指定一个，且仅允许指定一个。

>- O_RDONLY 只读打开
>- O_WRONLY 只写打开
>- O_RDWR  可读可写打开

可选项：以下可选项可以同时指定0个或多个，与必选项按位或作为flags参数。

>- O_APPEND 追加。如果文件已有内容，这次打开文件所写的数据附加到文件的末尾而不覆盖原来的内容。
>- O_CREAT 若此文件不存在则创建它。使用此选项时需要提供第三个参数mode，表示该文件的访问权限。
>- O_EXCL 如果同时指定了O_CREAT，并且文件已存在则出错返回。
>- O_TRUNC 如果文件已存在，并以只写或可读可写方式打开，则将其长度截断(Truncate)为0字节。
>- O_NONBLOCK 对于设备文件，以O_NONBLOCK方式打开可以做非阻塞I/O(Nonblock I/O)。