# ATS

ApacheTrafficServer（ATS 或 TS）是一个高性能的、模块化的 HTTP 代理和缓存服务器。TrafficServer 最初是 Inktomi 公司的商业产品，该公司在 2003 年被 Yahoo 收购，之后 TrafficServer 一直在 Yahoo 内部使用长达 4 年，直到 2009 年 8 月 Yahoo 向 Apache 软件基金会（ASF）贡献了源代码，并于 2010 年 4 月成为了 ASF 的顶级项目（Top-LevelProject）。ApacheTrafficServer 现在是一个开源项目，开发语言为 C++。

TrafficServer 的开发团队曾经由 ChuckNeerdaels 领导，他也是 Harvest 项目的早期创始人之一，Harvest 项目后来发展为十分流行的 Squid 项目；LeifHedstrom 直接管理着现在的 TrafficServer 开发团队。目前 ChuckNeerdaels 和 LeifHedstrom 都已加盟知名 CDN 服务提供商 Akamai。

HTTP 代理服务器是 HTTP 服务器的一种实现，处于客户端（一般为浏览器）与另一个 HTTP 服务器之间（通常指源服务器，OriginServer）。HTTP 代理通常分为正向代理、反向代理和透明代理，我们主要关注的是反向代理（ReverseProxy）反向代理服务器根据明确配置的映射规则来处理用户请求。反向代理服务器通常会设置一个较大的缓存区，服务器处理请求的同时将请求的内容缓存在服务器本地，当下次用户请求同一个对象时，服务器可直接从缓存区里取出对象，而不用去源服务器去取，起到了加速的效果。另外，配置反向代理的映射规则也能实现负载均衡的功能。除了 TrafficServer，常见的开源代理服务器还有 Squid，Varnish，Nginx，HAProxy。

ATS 既可以用作 HTTP 代理，也可以用作 HTTP 缓存，ATS 能够缓存任何字节流，虽然它当前只支持 HTTP 协议传输的字节流，当这样的流缓存时，会带一个 HTTP 协议头部，会命名为缓存中的一个对象 object。每个对象通过一个名为 cachekey 的全局唯一值识别。

## 正向代理

应用：vpn、科学上网

>-正向代理的典型用途是为在防火墙内的局域网客户端提供访问 Internet 的途径。
>-正向代理还可以使用缓冲特性 (由 mod_cache 提供) 减少网络使用率。
>-代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息。

通过配置代理服务器，可以将客户端的请求代为发送到目标服务器，再由代理服务器将目标服务器的响应转发回本地。从而隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都由代理服务器代替来请求。客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的 IP 地址，还有代理程序的端口。举个例子，国内的用户想要访问 Google 时，会被阻挡。所以这个时候把请求发送到另外一个代理服务器（可以访问 Google 的服务器）上，由其代为转发请求和接收响应内容。

## 反向代理

应用：安全、负载均衡方面的常用配置

>-保证证内网的安全，可以使用反向代理提供 WAF 功能，阻止 web 攻击。大型网站，通常将反向代理作为公网访问地址，Web 服务器是内网。
>-负载均衡，通过反向代理服务器来优化网站的负载。

反向代理对外的表现都是透明的，客户不知道自己访问的是代理服务器，客户端也不需要任何配置就可以访问。当配置好代理服务器后，反向代理（ReverseProxy）实际运行方式是指以代理服务器来接受 Internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 internet 上请求连接的客户端，此时代理服务器对外就表现为一个服务器。

## 区别总结

正向代理中，proxy 和 client 同属一个 lan，对 server 透明。正向代理需要配置在 client 端；
反向代理中，proxy 和 server 同属一个 lan，对 client 透明。反向代理需要配置在 proxy 端；
实际上 proxy 在两种代理中做的事都是代为请求和响应，不过从结构上看正好左右相反，故称为正反向代理。
