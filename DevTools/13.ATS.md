# ATS

ApacheTrafficServer（ATS或TS）是一个高性能的、模块化的HTTP代理和缓存服务器。TrafficServer最初是Inktomi公司的商业产品，该公司在2003年被Yahoo收购，之后TrafficServer一直在Yahoo内部使用长达4年，直到2009年8月Yahoo向Apache软件基金会（ASF）贡献了源代码，并于2010年4月成为了ASF的顶级项目（Top-LevelProject）。ApacheTrafficServer现在是一个开源项目，开发语言为C++。

TrafficServer的开发团队曾经由ChuckNeerdaels领导，他也是Harvest项目的早期创始人之一，Harvest项目后来发展为十分流行的Squid项目；LeifHedstrom直接管理着现在的TrafficServer开发团队。目前ChuckNeerdaels和LeifHedstrom都已加盟知名CDN服务提供商Akamai。

HTTP代理服务器是HTTP服务器的一种实现，处于客户端（一般为浏览器）与另一个HTTP服务器之间（通常指源服务器，OriginServer）。HTTP代理通常分为正向代理、反向代理和透明代理，我们主要关注的是反向代理（ReverseProxy）反向代理服务器根据明确配置的映射规则来处理用户请求。反向代理服务器通常会设置一个较大的缓存区，服务器处理请求的同时将请求的内容缓存在服务器本地，当下次用户请求同一个对象时，服务器可直接从缓存区里取出对象，而不用去源服务器去取，起到了加速的效果。另外，配置反向代理的映射规则也能实现负载均衡的功能。除了TrafficServer，常见的开源代理服务器还有Squid，Varnish，Nginx，HAProxy。

ATS既可以用作HTTP代理，也可以用作HTTP缓存，ATS能够缓存任何字节流，虽然它当前只支持HTTP协议传输的字节流，当这样的流缓存时，会带一个HTTP协议头部，会命名为缓存中的一个对象object。每个对象通过一个名为cachekey的全局唯一值识别。

## 正向代理

应用：vpn、科学上网

>-正向代理的典型用途是为在防火墙内的局域网客户端提供访问Internet的途径。
>-正向代理还可以使用缓冲特性(由mod_cache提供)减少网络使用率。
>-代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息。

通过配置代理服务器，可以将客户端的请求代为发送到目标服务器，再由代理服务器将目标服务器的响应转发回本地。从而隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都由代理服务器代替来请求。客户端必须设置正向代理服务器，当然前提是要知道正向代理服务器的IP地址，还有代理程序的端口。举个例子，国内的用户想要访问Google时，会被阻挡。所以这个时候把请求发送到另外一个代理服务器（可以访问Google的服务器）上，由其代为转发请求和接收响应内容。

## 反向代理

应用：安全、负载均衡方面的常用配置

>-保证证内网的安全，可以使用反向代理提供WAF功能，阻止web攻击。大型网站，通常将反向代理作为公网访问地址，Web服务器是内网。
>-负载均衡，通过反向代理服务器来优化网站的负载。

反向代理对外的表现都是透明的，客户不知道自己访问的是代理服务器，客户端也不需要任何配置就可以访问。当配置好代理服务器后，反向代理（ReverseProxy）实际运行方式是指以代理服务器来接受Internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。

## 区别总结

正向代理中，proxy和client同属一个lan，对server透明。正向代理需要配置在client端；
反向代理中，proxy和server同属一个lan，对client透明。反向代理需要配置在proxy端；
实际上proxy在两种代理中做的事都是代为请求和响应，不过从结构上看正好左右相反，故称为正反向代理。
